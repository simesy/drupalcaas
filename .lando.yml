name: caas
recipe: drupal9
config:
  webroot: web
  # Off by default for performance. Set to `true` and run `lando rebuild` (will not reset database).
  xdebug: false
keys:
  - id_rsa
services:
  solr:
    type: solr:7.7
    portforward: true
    scanner: false
    core: drupal
    config:
      dir: .platform/configsets/solr7
    phpmyadmin:
      type: phpmyadmin
      hosts:
        - database
  node:
    type: node
    scanner: false
    globals:
      gulp-cli: latest
  elasticsearch:
    type: elasticsearch:7.9.3
    scanner: false
    portforward: true

events:
  post-start:
    - chmod 600 config/misc/dev-oauth/dev-public.key

tooling:
#  drush:
#    service: appserver
  sync-prod:
    service: appserver
    description: Syncs prod database and files to local.
    cmd:
      - drush sql:drop
      - drush sql:sync @prod @self --yes
      - drush cache:rebuild
      - drush user:login
  theme-build:
    service: node
    description: Build the theme.
    dir: /app/web/themes/custom/legin
    cmd: npm install
  theme-watch:
    service: node
    description: Watch the theme.
    dir: /app/web/themes/custom/legin
    cmd: gulp
  theme-generate:
    service: node
    description: Watch the theme.
    dir: /app/web/themes/custom/legin
    cmd: gulp sass
